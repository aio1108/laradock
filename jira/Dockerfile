ARG JIRA_VERSION
FROM atlassian/jira-software:${JIRA_VERSION}

USER root

COPY "mysql-connector-java-8.0.20.jar" /opt/atlassian/jira/lib/

COPY "atlassian-agent.jar" /opt/atlassian/jira/

ARG JIRA_ATL_PROXY_NAME
ENV JIRA_ATL_PROXY_NAME ${JIRA_ATL_PROXY_NAME}

ARG JIRA_ATL_PROXY_PORT
ENV JIRA_ATL_PROXY_PORT ${JIRA_ATL_PROXY_PORT}

ARG JIRA_ATL_TOMCAT_SCHEME
ENV JIRA_ATL_TOMCAT_SCHEME ${JIRA_ATL_TOMCAT_SCHEME}

ARG JIRA_ATL_TOMCAT_SECURE
ENV JIRA_ATL_TOMCAT_SECURE ${JIRA_ATL_TOMCAT_SECURE}

ARG JIRA_ATL_JDBC_URL
ENV JIRA_ATL_JDBC_URL ${JIRA_ATL_JDBC_URL}

ARG JIRA_ATL_JDBC_USER
ENV JIRA_ATL_JDBC_USER ${JIRA_ATL_JDBC_USER}

ARG JIRA_ATL_JDBC_PASSWORD
ENV JIRA_ATL_JDBC_PASSWORD ${JIRA_ATL_JDBC_PASSWORD}

RUN echo 'export CATALINA_OPTS="-javaagent:/opt/atlassian/jira/atlassian-agent.jar ${CATALINA_OPTS}"' >> /opt/atlassian/jira/bin/setenv.sh

EXPOSE 8080

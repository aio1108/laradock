ARG CONFLUENCE_VERSION
FROM atlassian/confluence:${CONFLUENCE_VERSION}

USER root

COPY "mysql-connector-java-8.0.20.jar" /opt/atlassian/confluence/lib/

COPY "atlassian-agent.jar" /opt/atlassian/confluence/

ARG CONFLUENCE_ATL_PROXY_NAME
ENV CONFLUENCE_ATL_PROXY_NAME ${CONFLUENCE_ATL_PROXY_NAME}

ARG CONFLUENCE_ATL_PROXY_PORT
ENV CONFLUENCE_ATL_PROXY_PORT ${CONFLUENCE_ATL_PROXY_PORT}

ARG CONFLUENCE_ATL_TOMCAT_SCHEME
ENV CONFLUENCE_ATL_TOMCAT_SCHEME ${CONFLUENCE_ATL_TOMCAT_SCHEME}

ARG CONFLUENCE_ATL_TOMCAT_SECURE
ENV CONFLUENCE_ATL_TOMCAT_SECURE ${CONFLUENCE_ATL_TOMCAT_SECURE}

ARG CONFLUENCE_ATL_JDBC_URL
ENV CONFLUENCE_ATL_JDBC_URL ${CONFLUENCE_ATL_JDBC_URL}

ARG CONFLUENCE_ATL_JDBC_USER
ENV CONFLUENCE_ATL_JDBC_USER ${CONFLUENCE_ATL_JDBC_USER}

ARG CONFLUENCE_ATL_JDBC_PASSWORD
ENV CONFLUENCE_ATL_JDBC_PASSWORD ${CONFLUENCE_ATL_JDBC_PASSWORD}

RUN echo 'export CATALINA_OPTS="-javaagent:/opt/atlassian/confluence/atlassian-agent.jar ${CATALINA_OPTS}"' >> /opt/atlassian/confluence/bin/setenv.sh

EXPOSE 8090
